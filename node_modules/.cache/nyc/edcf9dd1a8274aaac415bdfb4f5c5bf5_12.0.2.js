var cov_2cb58yw6wr=function(){var path="/Users/tormodflesjo/tormodWork/ironbot/src/Game.js",hash="0878bb99c4417a9645bd63f3c025f1366e5ac7de",Function=function(){}.constructor,global=new Function('return this')(),gcv="__coverage__",coverageData={path:"/Users/tormodflesjo/tormodWork/ironbot/src/Game.js",statementMap:{"0":{start:{line:15,column:4},end:{line:15,column:19}},"1":{start:{line:16,column:4},end:{line:16,column:21}},"2":{start:{line:17,column:4},end:{line:17,column:25}},"3":{start:{line:21,column:4},end:{line:21,column:25}},"4":{start:{line:22,column:4},end:{line:22,column:64}},"5":{start:{line:22,column:43},end:{line:22,column:62}},"6":{start:{line:26,column:4},end:{line:31,column:5}},"7":{start:{line:27,column:20},end:{line:27,column:47}},"8":{start:{line:28,column:6},end:{line:30,column:7}},"9":{start:{line:29,column:8},end:{line:29,column:54}},"10":{start:{line:35,column:4},end:{line:48,column:5}},"11":{start:{line:37,column:8},end:{line:37,column:35}},"12":{start:{line:38,column:8},end:{line:38,column:14}},"13":{start:{line:40,column:8},end:{line:40,column:44}},"14":{start:{line:41,column:8},end:{line:41,column:45}},"15":{start:{line:42,column:8},end:{line:42,column:14}},"16":{start:{line:44,column:8},end:{line:44,column:39}},"17":{start:{line:45,column:8},end:{line:45,column:14}},"18":{start:{line:47,column:8},end:{line:47,column:71}},"19":{start:{line:52,column:18},end:{line:52,column:72}},"20":{start:{line:53,column:4},end:{line:59,column:5}},"21":{start:{line:54,column:23},end:{line:54,column:53}},"22":{start:{line:55,column:6},end:{line:58,column:7}},"23":{start:{line:56,column:8},end:{line:56,column:79}},"24":{start:{line:57,column:8},end:{line:57,column:49}},"25":{start:{line:63,column:4},end:{line:63,column:64}},"26":{start:{line:67,column:17},end:{line:67,column:33}},"27":{start:{line:68,column:4},end:{line:68,column:66}},"28":{start:{line:72,column:0},end:{line:72,column:22}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:14,column:2},end:{line:14,column:3}},loc:{start:{line:14,column:33},end:{line:18,column:3}},line:14},"1":{name:"(anonymous_1)",decl:{start:{line:20,column:2},end:{line:20,column:3}},loc:{start:{line:20,column:16},end:{line:23,column:3}},line:20},"2":{name:"(anonymous_2)",decl:{start:{line:22,column:32},end:{line:22,column:33}},loc:{start:{line:22,column:43},end:{line:22,column:62}},line:22},"3":{name:"(anonymous_3)",decl:{start:{line:25,column:2},end:{line:25,column:3}},loc:{start:{line:25,column:24},end:{line:32,column:3}},line:25},"4":{name:"(anonymous_4)",decl:{start:{line:34,column:2},end:{line:34,column:3}},loc:{start:{line:34,column:17},end:{line:49,column:3}},line:34},"5":{name:"(anonymous_5)",decl:{start:{line:51,column:2},end:{line:51,column:3}},loc:{start:{line:51,column:30},end:{line:60,column:3}},line:51},"6":{name:"(anonymous_6)",decl:{start:{line:62,column:2},end:{line:62,column:3}},loc:{start:{line:62,column:19},end:{line:64,column:3}},line:62},"7":{name:"(anonymous_7)",decl:{start:{line:66,column:2},end:{line:66,column:3}},loc:{start:{line:66,column:24},end:{line:69,column:3}},line:66}},branchMap:{"0":{loc:{start:{line:26,column:4},end:{line:31,column:5}},type:"if",locations:[{start:{line:26,column:4},end:{line:31,column:5}},{start:{line:26,column:4},end:{line:31,column:5}}],line:26},"1":{loc:{start:{line:28,column:6},end:{line:30,column:7}},type:"if",locations:[{start:{line:28,column:6},end:{line:30,column:7}},{start:{line:28,column:6},end:{line:30,column:7}}],line:28},"2":{loc:{start:{line:35,column:4},end:{line:48,column:5}},type:"switch",locations:[{start:{line:36,column:6},end:{line:38,column:14}},{start:{line:39,column:6},end:{line:42,column:14}},{start:{line:43,column:6},end:{line:45,column:14}},{start:{line:46,column:6},end:{line:47,column:71}}],line:35},"3":{loc:{start:{line:52,column:18},end:{line:52,column:72}},type:"cond-expr",locations:[{start:{line:52,column:43},end:{line:52,column:45}},{start:{line:52,column:48},end:{line:52,column:72}}],line:52},"4":{loc:{start:{line:53,column:4},end:{line:59,column:5}},type:"if",locations:[{start:{line:53,column:4},end:{line:59,column:5}},{start:{line:53,column:4},end:{line:59,column:5}}],line:53},"5":{loc:{start:{line:55,column:6},end:{line:58,column:7}},type:"if",locations:[{start:{line:55,column:6},end:{line:58,column:7}},{start:{line:55,column:6},end:{line:58,column:7}}],line:55},"6":{loc:{start:{line:63,column:11},end:{line:63,column:63}},type:"cond-expr",locations:[{start:{line:63,column:46},end:{line:63,column:53}},{start:{line:63,column:56},end:{line:63,column:63}}],line:63},"7":{loc:{start:{line:68,column:11},end:{line:68,column:65}},type:"cond-expr",locations:[{start:{line:68,column:35},end:{line:68,column:47}},{start:{line:68,column:52},end:{line:68,column:64}}],line:68}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},b:{"0":[0,0],"1":[0,0],"2":[0,0,0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0]},_coverageSchema:"d34fc3e6b8297bcde183f5492bcb8fcb36775295"},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();/**
 * Game subscribes to gameId events and handles them posting moves
 * generated by player object that must implement two methods:
 * 
 * getNextMove(array of uciMoves) returns uciMove
 * getReply(chat event) returns chat message  
 * 
 */class Game{/**
   * Initialise with interface to lichess.
   */constructor(api,name,player){cov_2cb58yw6wr.f[0]++;cov_2cb58yw6wr.s[0]++;this.api=api;cov_2cb58yw6wr.s[1]++;this.name=name;cov_2cb58yw6wr.s[2]++;this.player=player;}start(gameId){cov_2cb58yw6wr.f[1]++;cov_2cb58yw6wr.s[3]++;this.gameId=gameId;cov_2cb58yw6wr.s[4]++;this.api.streamGame(gameId,event=>{cov_2cb58yw6wr.f[2]++;cov_2cb58yw6wr.s[5]++;return this.handler(event);});}handleChatLine(event){cov_2cb58yw6wr.f[3]++;cov_2cb58yw6wr.s[6]++;if(event.username!==this.name){cov_2cb58yw6wr.b[0][0]++;const reply=(cov_2cb58yw6wr.s[7]++,this.player.getReply(event));cov_2cb58yw6wr.s[8]++;if(reply){cov_2cb58yw6wr.b[1][0]++;cov_2cb58yw6wr.s[9]++;this.api.chat(this.gameId,event.room,reply);}else{cov_2cb58yw6wr.b[1][1]++;}}else{cov_2cb58yw6wr.b[0][1]++;}}handler(event){cov_2cb58yw6wr.f[4]++;cov_2cb58yw6wr.s[10]++;switch(event.type){case"chatLine":cov_2cb58yw6wr.b[2][0]++;cov_2cb58yw6wr.s[11]++;this.handleChatLine(event);cov_2cb58yw6wr.s[12]++;break;case"gameFull":cov_2cb58yw6wr.b[2][1]++;cov_2cb58yw6wr.s[13]++;this.colour=this.playingAs(event);cov_2cb58yw6wr.s[14]++;this.playNextMove(event.state.moves);cov_2cb58yw6wr.s[15]++;break;case"gameState":cov_2cb58yw6wr.b[2][2]++;cov_2cb58yw6wr.s[16]++;this.playNextMove(event.moves);cov_2cb58yw6wr.s[17]++;break;default:cov_2cb58yw6wr.b[2][3]++;cov_2cb58yw6wr.s[18]++;console.log("Unhandled game event : "+JSON.stringify(event));}}playNextMove(previousMoves){cov_2cb58yw6wr.f[5]++;const moves=(cov_2cb58yw6wr.s[19]++,previousMoves===""?(cov_2cb58yw6wr.b[3][0]++,[]):(cov_2cb58yw6wr.b[3][1]++,previousMoves.split(" ")));cov_2cb58yw6wr.s[20]++;if(this.isTurn(this.colour,moves)){cov_2cb58yw6wr.b[4][0]++;const nextMove=(cov_2cb58yw6wr.s[21]++,this.player.getNextMove(moves));cov_2cb58yw6wr.s[22]++;if(nextMove){cov_2cb58yw6wr.b[5][0]++;cov_2cb58yw6wr.s[23]++;console.log(this.name+" as "+this.colour+" to move "+nextMove);cov_2cb58yw6wr.s[24]++;this.api.makeMove(this.gameId,nextMove);}else{cov_2cb58yw6wr.b[5][1]++;}}else{cov_2cb58yw6wr.b[4][1]++;}}playingAs(event){cov_2cb58yw6wr.f[6]++;cov_2cb58yw6wr.s[25]++;return event.white.name===this.name?(cov_2cb58yw6wr.b[6][0]++,"white"):(cov_2cb58yw6wr.b[6][1]++,"black");}isTurn(colour,moves){cov_2cb58yw6wr.f[7]++;var parity=(cov_2cb58yw6wr.s[26]++,moves.length%2);cov_2cb58yw6wr.s[27]++;return colour==="white"?(cov_2cb58yw6wr.b[7][0]++,parity===0):(cov_2cb58yw6wr.b[7][1]++,parity===1);}}cov_2cb58yw6wr.s[28]++;module.exports=Game;